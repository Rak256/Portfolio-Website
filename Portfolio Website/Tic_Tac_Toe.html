<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./style.css">
    <title>Tic Tac Toe in JavaScript</title>
</head>
<body>
    <h1 id = "game_header">Tic Tac Toe</h1>
    <div id = "board">
       <button id = "0"></button>
       <button id = "1"></button>
       <button id = "2"></button>
       <button id = "3"></button>
       <button id = "4"></button>
       <button id = "5"></button>
       <button id = "6"></button>
       <button id = "7"></button>
       <button id = "8"></button>
    </div>
    <div id="message"></div>

    <div id = "clear_b"><button > Clear board</button></div>

</div>

<script>
var row1 = ["*", "*", "*"];
var row2 = ["*", "*", "*"];
var row3 = ["*", "*", "*"];
var end = false;

var player1 = true;
function click_wrapper(event){
    change_board(player1,event.target.id);
    if (!end){
     has_ended();
    }
    
}

function change_board(player1, id){
    let  box = document.getElementById(id);
    let index = Number(id);

    if (box.className === "marked"){
        return;
    }
    else{
        if (player1){
            box.innerHTML = "X";
            box.className = "marked";
            window.player1 = !player1;

            if(index < 3){
                row1[index] = "X"
            }
            else if(index < 6){
                row2[index - 3] = "X";
            }

            else{
                row3[index - 6] = "X";
            }

        }
    
        else{
            box.innerHTML = "O"; 
            box.className = "marked";
            window.player1 = !player1;

            if(index < 3){
                row1[index] = "O"
            }
            else if(index < 6){
               row2[index - 3] = "O";
            }

            else{
               row3[index - 6] = "O";
            }
        }
        }
        }

        function has_ended(){
            let message = document.getElementById("message");
            const empty = (currentValue) => currentValue !== '*';

            if ((row1[0] == 'X' && row2[1] == 'X' && row3[2] == 'X') || (row1[0] == 'X' && row1[1] == 'X' && row1[2] == 'X') || (row2[0] == 'X' && row2[1] == 'X' && row2[2] == 'X') || (row3[0] == 'X' && row3[1] == 'X' && row3[2] == 'X') || (row1[0] == 'X' && row2[0] == 'X' && row3[0] == 'X') || (row1[1]== 'X' && row2[1] == 'X' && row3[1] == 'X') || (row1[2] == 'X' && row2[2] == 'X' && row3[2] == 'X') || (row1[2] == 'X' && row2[1] == 'X' && row3[0] == 'X')){
            message.innerHTML = "Player 1 Won!";
            return true;
            }
            else if ((row1[0] == 'O' && row2[1] == 'O' && row3[2] == 'O') || (row1[0] == 'O' && row1[1] == 'O' && row1[2] == 'O') || (row2[0] == 'O' && row2[1] == 'O' && row2[2] == 'O') || (row3[0] == 'O' && row3[1] == 'O' && row3[2] == 'O') || (row1[0] == 'O' && row2[0] == 'O' && row3[0] == 'O') || (row1[1]== 'O' && row2[1] == 'O' && row3[1] == 'O') || (row1[2] == 'O' && row2[2] == 'O' && row3[2] == 'O') || (row1[2] == 'O' && row2[1] == 'O' && row3[0] == 'O')){
            message.innerHTML = "Player 2 Won!";
            window.end = true;
            return true;
            }
            // no end flag here as this would not logically conflict with the other statements
            else if (row1.every(empty) && row2.every(empty) && row3.every(empty)){
            message.innerHTML = "The game is a draw!";
            window.end = true;
            return true;
            }
            else{
            return false
            }
        }

        document.getElementById("0").addEventListener("click", click_wrapper);

        document.getElementById("1").addEventListener("click", click_wrapper);

        document.getElementById("2").addEventListener("click", click_wrapper);

        document.getElementById("3").addEventListener("click", click_wrapper);

        document.getElementById("4").addEventListener("click", click_wrapper);

        document.getElementById("5").addEventListener("click", click_wrapper);

        document.getElementById("6").addEventListener("click", click_wrapper);

        document.getElementById("7").addEventListener("click", click_wrapper);

        document.getElementById("8").addEventListener("click", click_wrapper);

        document.getElementById("clear_b").addEventListener("click", () => {
            let all_boxes = document.getElementById("board").getElementsByTagName("button");
            window.row1 = ["*", "*", "*"];
            window.row2 = ["*", "*", "*"];
            window.row3 = ["*", "*", "*"];

            for(k = 0; k < all_boxes.length; k++){
                all_boxes[k].removeAttribute("class");
                all_boxes[k].innerHTML = "";
            }

            window.end = false;
            window.player1 = true;

            document.getElementById("message").innerHTML = "";
        });

</script>

    </body>
</html>